name: Build APK

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: üì• –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      uses: actions/checkout@v3

    - name: üêç –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      run: |
        sudo apt update
        sudo apt install -y zip unzip openjdk-17-jdk
        python3 -m pip install --upgrade pip
        pip install buildozer

    - name: üîß –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ –≤—Ä—É—á–Ω—É—é
      run: |
        git clone https://github.com/kivy/buildozer.git buildozer-docker
        docker build -t my-buildozer buildozer-docker/docker

    - name: ‚öôÔ∏è –°–±–æ—Ä–∫–∞ APK —á–µ—Ä–µ–∑ Docker
      run: |
        docker run --rm -v ${{ github.workspace }}:/app my-buildozer buildozer android debug

    - name: üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ APK –≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
      uses: actions/upload-artifact@v4
      with:
        name: kivyapp-apk
        path: bin/*.apk
